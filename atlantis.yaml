version: 3
automerge: true
projects:
  - name: s3/seeun-id
    dir: terraform/s3/seeun-id
    workspace: default
    terraform_version: 1.3.7
    autoplan:
      when_modified: [
         "*.tf"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: vpc/seeun_id_apnortheast2
    dir: terraform/vpc/seeun_id_apnortheast2
    workspace: default
    terraform_version: 1.5.7
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id


  - name: iam/seeun_id
    dir: terraform/iam/seeun-id
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: kms/seeun-id/ap-northeast-2
    dir: terraform/kms/seeun-id/ap-northeast-2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: ssm/seeun-id/ap-northeast-2
    dir: terraform/ssm/seeun-id/ap-northeast-2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "secrets.sops.yaml"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: jenkins/seeun-id_ap-northeast-2
    dir: terraform/platform/jenkins/seeun_id_apnortheast2
    workspace: default
    terraform_version: 1.13.0
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id
  
  - name: security_group/seeun-id_ap-northeast-2
    dir: terraform/securitygroup/seeun-id/seeun_id_apnortheast2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: codebuild/seeun-id_ap-northeast-2
    dir: terraform/codebuild/seeun-id/seeun_id_apnortheast2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

  - name: secretsmanager/seeun-id_ap-northeast-2
    dir: terraform/secretsmanager/seeun-id/ap-northeast-2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "terraform.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: id

#### Workflows #####
workflows:
  # id
  id:
    plan:
      steps:
        - init:
            extra_args: [
              '-backend-config="role_arn=arn:aws:iam::680463082671:role/atlantis-seeun-id-admin"',
              '-upgrade=false'
            ]
        - plan:
            extra_args: [
              "-var 'assume_role_arn=arn:aws:iam::680463082671:role/atlantis-seeun-id-admin'"
            ]
    apply:
      steps:
        - apply
